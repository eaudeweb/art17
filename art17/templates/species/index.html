{% extends "common/indexpage.html" %}


{% block breadcrumbs %}
  {%- from 'bits.html' import breadcrumbs %}
  {{ breadcrumbs([
          ('acasǎ', url_for('views.home')),
          ('specii', None),
      ]) }}
{% endblock breadcrumbs %}


{% block form %}
  <form class="speciesfilter form-inline">
    <fieldset>
      <legend>Filtrare specii</legend>

      <div class="form-group">
        <label for="speciesfilter-group">Grup</label>
        <input name="group" value="{{ current_group_code }}"
               type="hidden" id="speciesfilter-group">
      </div>

      <div class="form-group">
        <label for="speciesfilter-species">Specie</label>
        <input name="species" value="{{ current_subject_code or '' }}"
               type="hidden" id="speciesfilter-species">
      </div>

      <div class="form-group">
        <label for="speciesfilter-region">Bioregiuni</label>
        <input name="region" value="{{ current_region_code }}"
               type="hidden" id="speciesfilter-region">
      </div>

      <div class="form-group">
        <button type="submit" class="btn btn-sm btn-primary">filtrează</button>
        {%- if map_url %}
          <a class="showmap btn btn-sm btn-info"
             href="{{ map_url }}">vezi harta</a>
        {%- endif %}
        <a class="helpbox-button btn btn-sm btn-default"
           href="#">ajutor</a>
      </div>
    </fieldset>
  </form>
{% endblock form %}


{% block subject_details %}
  <p class="subject-details">
    {%- set annex_list =
      (["II"] if annex_II else []) +
      (["IV"] if annex_IV else []) +
      (["V"] if annex_V else []) %}

    <strong>{{ name }}</strong>,
    cod: {{ code }},
    anexe: {{ ", ".join(annex_list) if annex_list else "--" }}
  </p>
{% endblock subject_details %}


{% block records_header %}
  <tr class="records-header">
    <th rowspan=2></th>
    <th colspan=5>Areal (km²)</th>
    <th colspan=4>Populație</th>
    <th colspan=6>Habitate (km²)</th>
    <th rowspan=2
        title="Perspective viitoare"
        >Persp.</th>
    <th rowspan=2
        title="Evaluare generală a stării de conservare"
        >Eval.</th>
    <th rowspan=2 colspan=4></th>  {#- conclusion (author, etc) #}
  </tr>

  <tr class="records-header">
    {#- detail #}
    {#- bio-regiune #}
    {#- range #}
    <th title="Suprafața">Supr.</th>
    <th title="Concluzie">Concl.</th>
    <th title="Tendința pe termen scurt">Tend.<br>t.scurt</th>
    <th title="Metoda folositǎ">Met.</th>
    <th title="Arealul de referință favorabil">Ref.</th>
    {#- population #}
    <th title="Mărimea populației și unitatea de măsură">Nr.</th>
    <th title="Concluzie">Concl.</th>
    <th title="Tendința pe termen scurt">Tend.<br>t.scurt</th>
    <th title="Populația de referință">Ref.</th>
    {#- habitat #}
    <th title="Suprafața estimatǎ">Supr.</th>
    <th title="Concluzie">Concl.</th>
    <th title="Zona de referință favorabilă">Ref.</th>
    <th title="Metoda folositǎ">Met.</th>
    <th title="Tendința pe termen scurt">Tend.<br>t.scurt</th>
    <th title="Calitate">Cal.</th>
    {#- future prospects #}
    {#- overall assessment #}
  </tr>
{%- endblock records_header %}


{% block comments_header %}
  <tr class="records-header">
    <th colspan=22>Comentarii</th>
  </tr>
{% endblock comments_header %}


{% block record_cell %}
  {%- from 'common/td.html'
      import conclusion_td, reference_value_td, trend_td,
             population_size_td, habitat_quality_td
      with context %}

  {#- range #}
  {%- set range = row.range %}
  <td>{{ range.surface_area }}</td>
  {{ conclusion_td(range.conclusion) }}
  {{ trend_td(range.trend_short) }}
  <td class="method">{{ range.method }}</td>
  {{ reference_value_td(range.reference_value) }}

  {#- population #}
  {%- set population = row.population %}
  {{ population_size_td(population.size) }}
  {{ conclusion_td(population.conclusion) }}
  {{ trend_td(population.trend_short) }}
  {{ reference_value_td(population.reference_value) }}

  {#- habitat #}
  {%- set habitat = row.habitat %}
  <td>{{ habitat.surface_area }}</td>
  {{ conclusion_td(habitat.conclusion) }}
  <td>{{ habitat.area_suitable }}</td>
  <td class="method">{{ habitat.method }}</td>
  {{ trend_td(habitat.trend_short) }}
  {{ habitat_quality_td(habitat.quality) }}

  {#- future prospects #}
  {{ conclusion_td(row.future_prospects) }}

  {#- overall assessment #}
  {{ conclusion_td(row.overall_assessment) }}
{%- endblock %}


{% block script %}
  {{- super() }}

  <script>
    (function() {
      "use strict";
      var species_groups = {{ species_groups|tojson|safe }};
      var species_list = {{ subject_list|tojson|safe }};
      App.species_filter(species_groups, species_list);
    })();
  </script>
{% endblock script %}

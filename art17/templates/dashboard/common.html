{%- macro tabmenu(current) %}
  <ul class="nav nav-tabs">
    {% for item in tabmenu_data %}
      <li {%- if item['code'] == current %} class="active" {%- endif %}>
        <a href="{{ item['url'] }}">{{ item['label'] }}</a>
      </li>
    {% endfor %}
  </ul>
{%- endmacro %}


{%- macro table(bioreg_list, subject_list, cell) %}
  <table class="table table-bordered">
    <thead>
      <th></th>

      {% for bioreg in bioreg_list %}
        <th title="{{ bioreg.name_ro }}">{{ bioreg.code }}</th>
      {% endfor %}
    </thead>

    <tbody>
    {% for subject in subject_list %}
      <tr>
        {%- set name = subject.lu.name_ro or subject.lu.speciesname %}
        <td title="{{ name }}">
          {{ subject.code }} â€“ {{ name|truncate(60) }}
        </td>

        {% for bioreg in bioreg_list %}
          {{ cell(subject, bioreg) }}
        {% endfor %}
      </tr>
    {% endfor %}
    </tbody>
  </table>
{%- endmacro %}


{%- macro consultation_cell(subject, bioreg) %}
  {%- set key = (subject.id, bioreg.code) %}
  {%- if key in data_by_region %}
    {%- set url = consultation_url(subject, bioreg=bioreg.code) %}
    {%- set cell_data = data_by_region[key] %}
    {%- if 'final_record' in cell_data %}

      {%- set final_record = cell_data['final_record'] %}
      {%- set conclusion_cls = (
            'conclusion-' +
            (final_record.conclusion_assessment or '')
          ) %}
      {%- set conclusion_title = (
            CONCLUSIONS.get(final_record.conclusion_assessment, '') +
            '; ' +
            TREND_NAME.get(final_record.conclusion_assessment_trend, '')
          ) %}

      <td class="dashboard-commentcount {{ conclusion_cls }}">
        <a href="{{ url }}" title="{{ conclusion_title }}">
          {{ final_record.conclusion_assessment_trend or '...' }}
        </a>
      </td>

    {%- else %}

      {%- set with_unread_reply = (
            cell_data['with_reply'] -
            cell_data['with_read_reply']
          ) %}

      <td class="dashboard-commentcount">
        <a href="{{ url }}">
          {% if with_unread_reply > 0 %}[newreply]{% endif %}
          {% if cell_data['unevaluated'] > 0 %}[evalme]{% endif %}
          {{ cell_data['count'] }} comentarii
        </a>
      </td>

    {%- endif %}
  {%- else %}
    <td class="dashboard-missingrecord"></td>
  {%- endif %}
{%- endmacro %}

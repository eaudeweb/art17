{% extends "layout.html" %}


{% block content %}
<div class="jumbotron">
  <div class="container">
    <h2>
      Agregarea datelor primare
      pentru Articolul 17 din Directiva Habitate
    </h2>

    <p>
      <a class="btn btn-primary"
         href="{{ url_for('.aggregate') }}">Agregare</a>

      {% if config['AUTH_DEBUG'] %}
        <a class="btn btn-danger"
           href="{{ url_for('auth.debug') }}">autentificare (debug)</a>
      {% endif %}
    </p>
  </div>
</div>


<h2>Seturi de date</h2>

<table class="table table-bordered">
  <thead>
    <th>Dată</th>
    <th>Utilizator</th>
    <th></th>
    <th></th>
  </thead>

  {%- for dataset in dataset_list %}
    {%- set url = url_for('.dashboard', dataset_id=dataset.id) %}
    {%- set delete_url = url_for('.delete_dataset', dataset_id=dataset.id) %}
    {%- set activity_url = url_for('history_aggregation.index', dataset_id=dataset.id) %}
    <tr>
      <td><a href="{{ url }}">{{ dataset.date }}</a></td>
      <td>{{ dataset.user_id }}</td>
      <td>{{ dataset.comment or ""|truncate(100) }}</td>
      <td>
        <form method="post" action="{{ delete_url }}"
              class="delete-dataset-form">
          <button type="submit" class="btn btn-danger btn-xs">șterge</button>
          <a class="btn btn-warning btn-xs"
             href="{{ activity_url }}">activitate</a>
        </form>
      </td>
    </tr>
  {%- endfor %}
</table>
{% endblock content %}


{% block script %}
{{ super() }}
{%- from 'bits.html' import script %}
{{ script('common.js') }}
<script>
  App.confirm_before_submit(
    '.delete-dataset-form',
    "Întreaga agregare va fi ștearsă!"
  );
</script>
{% endblock script %}

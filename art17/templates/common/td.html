{%- from 'bits.html' import fonticon %}


{% macro measure_icon(measure) -%}
  {% if measure|int %}
    {{ fonticon('check') }}
  {% else %}
    {{ fonticon('unchecked') }}
  {% endif %}
{% endmacro %}


{% macro conclusion_td(conclusion) -%}
  <td class="conclusion conclusion-{{ conclusion.value }}">{{ conclusion.value }}</td>
{%- endmacro %}


{% macro method_html(method) %}
{%- if method %}
  {{ method }} - {{ METHODS_USED[method] -}}
{% endif %}
{%- endmacro %}


{% macro method_pressures_html(method) %}
{%- if method %}
  {{ method }} - {{ METHODS_PRESSURES[method] -}}
{% endif %}
{%- endmacro %}


{% macro method_threats_html(method) %}
{%- if method %}
  {{ method }} - {{ METHODS_THREATS[method] -}}
{% endif %}
{%- endmacro %}


{% macro reference_value_html(refval, unit='', ideal='') %}
  {%- if refval.number -%}
    {{ refval.number }} {{ unit }}
  {%- elif refval.op -%}
    {{ refval.op }}{{ ideal }} {{ unit }}
  {%- elif refval.x -%}
    Necunoscut.
  {%- else -%}
    N/A
  {%- endif -%}
{%- endmacro %}


{% macro reasons_for_change_html(range) %}
  {%- for k,v in range.reasons_for_change.items() %}
    {% if v|int %}
      * {{ LU_REASONS_FOR_CHANGE[k] }} <br>
    {% endif %}
  {% endfor %}
{%- endmacro %}


{% macro reference_value_td(refval, unit='') -%}
  <td {% if refval.method -%}
        title="Metoda utilizată: {{ refval.method }}"
      {%- endif %}>
    {{- reference_value_html(refval, unit='', ideal='') -}}
  </td>
{%- endmacro %}

{% macro range_html(range) %}
{%- if range.surface_area -%}
  {{ range.surface_area }} km²
{%- endif -%}
{%- endmacro %}


{% macro magnitude_html(magnitude) -%}
{% if magnitude.min or magnitude.max %}
    {{ magnitude.min }} - {{ magnitude.max }} km²
{% endif %}
{%- endmacro %}


{% macro magnitude_ci_html(magnitude) -%}
{% if magnitude.min or magnitude.max %}
    {{ magnitude.min }} - {{ magnitude.max }}
{% endif %}
{% if magnitude.ci %}
  <span title="Intervalul de siguranță">({{ magnitude.ci|int }}%)</span>
{% endif %}
{%- endmacro %}


{% macro period_html(period) %}
{%- if period -%}
  {#- unicode character 2011: non-breaking hyphen -#}
  ({{ period.start }}&#x2011;{{ period.end }})
{%- endif %}
{%- endmacro %}


{% macro trend_detail_html(trend) %}
{%- if trend.trend %}
  {{ TREND_NAME[trend.trend] -}}
{% endif %}
{%- endmacro %}


{% macro trend_html(trend) %}
  {{- trend.trend -}} {# period_html(trend.period) #}
{%- endmacro %}


{% macro trend_td(trend) -%}
  {%- set tooltip = TREND_NAME[trend.trend] %}
  <td class="trend" title="{{ tooltip }}">{{ trend_html(trend) }}</td>
{%- endmacro %}


{% macro population_size_html(size) %}
  {%- set values_with_unit = [size['population'], size['population_alt']] | selectattr('unit') %}
  {%- for item in values_with_unit %}
    {%- if item.min == item.max -%}
      <span title="{{ item.min }}&nbsp;(
                   {{- get_population_units_ro(item.unit) }})">
        {{- item.min }} {{ item.unit -}}
      </span>
    {%- else -%}
      <span title="{{ item.min }}-{{ item.max }}&nbsp;(
                   {{- get_population_units_ro(item.unit) }})">
        {{- item.min }}-{{ item.max }} {{ item.unit -}}
      </span>
    {%- endif %}
    {%- if not loop.last %};<br>{% endif %}
  {%- endfor %}
{%- endmacro %}


{% macro natura2000_population_size_html(natura2000) %}
  {%- if natura2000.population_min == natura2000.population_max %}
    <span title="{{ natura2000.population_min }}&nbsp;(
              {{- get_population_units_ro(natura2000.population_unit) }})">
      {{- natura2000.population_min }}
      {{- natura2000.population_unit -}}
    </span>
  {%- else %}
    <span title="{{ natura2000.population_min }}&nbsp;-
                 {{- natura2000.population_max }}&nbsp;(
              {{- get_population_units_ro(natura2000.population_unit) }})">
      {{- natura2000.population_min -}}
      -
      {{- natura2000.population_max -}}
      &nbsp;
      {{- natura2000.population_unit -}}
    </span>
  {%- endif %}
{%- endmacro %}


{% macro natura2000_range_html(natura2000) %}
  {%- if natura2000.area_min or natura2000.area_max %}
    {%- if natura2000.area_min == natura2000.area_max %}
      {{- natura2000.area_min }} km<sup>2</sup>
    {%- else %}
      {{- natura2000.area_min -}}
      -
      {{- natura2000.area_max -}}
      &nbsp;
      km<sup>2</sup>
    {%- endif %}
  {%- endif %}
{%- endmacro %}


{% macro population_size_td(size) -%}
  <td>{{ population_size_html(size) }}</td>
{%- endmacro %}


{% macro habitat_quality_html(quality) %}
  {{- quality.value }}
{%- endmacro %}


{% macro habitat_quality_td(quality) -%}
  <td {% if quality.explanation -%}
        title="Metoda utilizată: {{ quality.explanation }}"
      {%- endif %}>
    {{- habitat_quality_html(quality) -}}
  </td>
{%- endmacro %}


{% macro conclusion_td_input(name) %}
  <td>
    <select name="{{ name }}">
      <option>FV</option>
      <option>U1</option>
      <option>U2</option>
      <option>XX</option>
    </select>
  </td>
{%- endmacro %}

{% macro conclusions_html(conclusion) %}
{%- if conclusion.value %}
    <strong>Concluzie:</strong><span class="conclusion {{ conclusion.value }}">{{ conclusion.value }}</span>{{ CONCLUSIONS[conclusion.value] }}
{%- endif %}
{%- if conclusion.trend %}
    &ensp;
    <strong>Tendință:</strong><span class="conclusion">{{ conclusion.trend }}</span>{{ TREND_NAME[conclusion.trend] }}
{% endif %}

{%- endmacro %}

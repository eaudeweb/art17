{% extends "layout.html" %}
{% from 'common/topic.html' import topic_html with context %}


{% block title %}
{%- if name %}{{ name }} &mdash; {% endif %}
{{- super() }}
{%- endblock title %}


{% block breadcrumbs %}
  {%- from 'bits.html' import breadcrumbs %}
  {{ breadcrumbs([
          ('acasǎ', home_url),
          ('consultare', dashboard_url),
          (subject.lu.code, None),
          (region.code, None),
      ]) }}
{% endblock breadcrumbs %}


{% block content %}
  <p>{{ subject.lu.display_name }}</p>

  <p>{{ region.name_ro }}</p>

  <p>
    <a class="showmap btn btn-sm btn-info" href="{{ map_url }}">vezi harta</a>
    <a class="helpbox-button btn btn-sm btn-default" href="#">ajutor</a>
    {%- if perm_view_history.can() %}
      {%- set history_url = url_for(
          comment_history_view,
          subject_code=subject.lu.code,
          region_code=region.code,
        ) %}
      <a class="btn btn-sm btn-danger" href="{{ history_url }}">istorie</a>
    {%- endif %}
  </p>
  {%- if not finalized %}
    {%- if perm_edit_final_for_this.can() %}
      <form method="post" action="{{ close_consultation_url }}">
        <a class="btn btn-sm btn-warning"
           href="{{ final_comment_url }}">editează versiunea finală</a>
        <button type="submit" class="btn btn-sm btn-danger">
          încheie consultarea
        </button>
      </form>
    {%- endif %}
  {%- else %}
    <p>Consultarea a fost finalizată.</p>
    {%- if perm_edit_final_for_this.can() %}
      <form method="post" action="{{ reopen_consultation_url }}">
        <button type="submit" class="btn btn-sm btn-danger">
          redeschide consultarea
        </button>
      </form>
    {%- endif %}
  {%- endif %}

  {{ topic_html(
    topic.assessment,
    topic.comments,
    topic_template,
    blueprint,
    finalized,
  ) }}


  {% include 'common/recorddetail.html' %}
  {% include 'common/helpbox.html' %}
{%- endblock content %}


{% block script %}
  {%- from 'bits.html' import script %}
  {{- super() }}
  <script>
    App.STATUS_OPTIONS = {{ STATUS_OPTIONS|tojson|safe }};
  </script>
  {{ script('indexpage.js') }}
  {{ script('detail.js') }}
  {{ script('replies.js') }}
{% endblock script %}
